"use strict";(self.webpackChunkgrants=self.webpackChunkgrants||[]).push([[42380],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var i=t(96540);const a={},s=i.createContext(a);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},49898:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"applications/parachain-staking","title":"Pallet-dPoS for Parachain Staking","description":"Proposer:* Moonbeam Network","source":"@site/applications/parachain-staking.md","sourceDirName":"applications","slug":"/applications/parachain-staking","permalink":"/applications/parachain-staking","draft":false,"unlisted":false,"editUrl":"https://github.com/w3f/Grants-Program/edit/master/applications/parachain-staking.md","tags":[],"version":"current","frontMatter":{}}');var a=t(74848),s=t(28453);const r={},o="Pallet-dPoS for Parachain Staking",l={},d=[{value:"Project Overview \ud83d\udcc4",id:"project-overview-page_facing_up",level:2},{value:"Background",id:"background",level:3},{value:"Team \ud83d\udc65",id:"team-busts_in_silhouette",level:2},{value:"Development Roadmap \ud83d\udd29",id:"development-roadmap-nut_and_bolt",level:2},{value:"Milestone 1: Improve Parachain-Staking Pallet",id:"milestone-1-improve-parachain-staking-pallet",level:3},{value:"Milestone 2: Parachain-Staking Polkadot-JS UI",id:"milestone-2-parachain-staking-polkadot-js-ui",level:3},{value:"Additional Information \u2795",id:"additional-information-heavy_plus_sign",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"pallet-dpos-for-parachain-staking",children:"Pallet-dPoS for Parachain Staking"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Proposer:"})," ",(0,a.jsx)(n.a,{href:"https://github.com/PureStake/moonbeam",children:"Moonbeam Network"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Payment Address:"})," 0x9a66721302d9f30a9d11cf48a09c7ef1a842b5c8"]}),"\n"]}),"\n",(0,a.jsxs)(n.h2,{id:"project-overview-page_facing_up",children:["Project Overview ","\ud83d\udcc4"]}),"\n",(0,a.jsxs)(n.p,{children:["Moonbeam is an Ethereum-compatible parachain built with Substrate. Since January 2021, Moonbeam's runtime developer team has written and maintained a delegated Proof of Stake (dPoS) implementation designed specifically for parachains called ",(0,a.jsx)(n.a,{href:"https://github.com/PureStake/moonbeam/tree/master/pallets/parachain-staking/src",children:(0,a.jsx)(n.code,{children:"parachain-staking"})}),". To make this code useful for other parachain teams, Moonbeam is applying for ecosystem funding to extend, benchmark, and document its dPoS implementation."]}),"\n",(0,a.jsx)(n.h3,{id:"background",children:"Background"}),"\n",(0,a.jsxs)(n.p,{children:["In the Polkadot consensus model, parachains have different requirements and constraints than the relay chain. While ",(0,a.jsx)(n.code,{children:"frame/pallet-staking"})," offers many features necessary for relay chain consensus and shared security, it is overkill for parachains, which operate with more limited execution resources."]}),"\n",(0,a.jsxs)(n.p,{children:["Instead of running an on-chain election, ",(0,a.jsx)(n.a,{href:"https://github.com/PureStake/moonbeam/tree/master/pallets/parachain-staking/src",children:(0,a.jsx)(n.code,{children:"parachain-staking"})})," implements direct delegation with a bounded number of nominations per ",(0,a.jsx)(n.code,{children:"AccountId"})," (maximum of ",(0,a.jsx)(n.code,{children:"Config::MaxCollatorsPerNominator"})," per account). In this paradigm, token holders (nominators) express exactly which collator candidates they would like to support and with what quantity of stake."]}),"\n",(0,a.jsxs)(n.p,{children:["There is a new round every ",(0,a.jsx)(n.code,{children:"<Round<T>>::get().length = 600"})," blocks. At the start of each round, the top ",(0,a.jsx)(n.code,{children:"<TotalSelected<T>>::get() = 16"})," collator candidates (in terms of total backing stake) are chosen to be in the active collator set. At every block, a subset of this active collator set is chosen pseudorandomly by the ",(0,a.jsx)(n.code,{children:"author-filter"})," pallet as valid block authors. Only valid block authors can produce blocks."]}),"\n",(0,a.jsxs)(n.p,{children:["Block authors are logged via the ",(0,a.jsx)(n.code,{children:"set_author_inherent"})," method in the ",(0,a.jsx)(n.code,{children:"author-inherent"})," pallet. The logic in this runtime method reports each block author to ",(0,a.jsx)(n.code,{children:"parachain-staking"}),", which distributes inflation rewards after a 2 round delay."]}),"\n",(0,a.jsxs)(n.h2,{id:"team-busts_in_silhouette",children:["Team ","\ud83d\udc65"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Members:"})," Derek Yoo, Alan Sapede, Antoine Estienne, Joshy Orndorff, Amar Singh"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"LinkedIn Profiles"}),": ",(0,a.jsx)(n.a,{href:"https://www.linkedin.com/in/derek-yoo-8a050/",children:"https://www.linkedin.com/in/derek-yoo-8a050/"}),", ",(0,a.jsx)(n.a,{href:"https://www.linkedin.com/in/alansapede/",children:"https://www.linkedin.com/in/alansapede/"}),","]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Code Repos:"})," ",(0,a.jsx)(n.a,{href:"https://github.com/PureStake/moonbeam",children:"https://github.com/PureStake/moonbeam"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Website:"})," ",(0,a.jsx)(n.a,{href:"https://www.purestake.com/",children:"https://www.purestake.com/"}),", ",(0,a.jsx)(n.a,{href:"https://moonbeam.network/",children:"https://moonbeam.network/"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Legal Structure:"})," PureStake Ltd, Floor 4, Willow House, Cricket Square, Grand Cayman, KY1-9010, Cayman Islands"]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Team's Experience:"})}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["The PureStake team has extensive experience developing and delivering complex web2 software systems. In the last year, PureStake has built a number of web3 infrastructure projects including Algorand API Services (",(0,a.jsx)(n.a,{href:"https://developer.purestake.io/",children:"https://developer.purestake.io/"}),") and the Goalseeker block explorer (",(0,a.jsx)(n.a,{href:"https://goalseeker.purestake.io/",children:"https://goalseeker.purestake.io/"}),"), among others."]}),"\n",(0,a.jsx)(n.p,{children:"Derek co-founded Fuze in 2006 and as CTO was responsible for engineering, technical operations, product management, and design as the company grew over time into a 700 person cloud business. Alan was responsible for large parts of the Fuze cloud backend. Before joining Fuze, Alan was on the Google Streetview Team and also worked at NVidia developing drivers."}),"\n",(0,a.jsx)(n.p,{children:"Antoine has been developing Web3 Dapps since 2016. He has participated in 3 projects inside ConsenSys (VariabL, Localties and Fathom) and helped HyperNetwork build their token system. Now, he's working for Moonbeam and has contributed to the polkadot-js suite (apps, common, api, etc)."}),"\n",(0,a.jsx)(n.p,{children:"Joshy and Amar worked at Parity on the Substrate Recipes."}),"\n",(0,a.jsxs)(n.h2,{id:"development-roadmap-nut_and_bolt",children:["Development Roadmap ","\ud83d\udd29"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Total Estimated Duration:"})," 6 weeks"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Full-time equivalent (FTE):"})," 2 FTE"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Total Costs:"})," 30000 DAI"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Both milestones will be worked on in parallel, but UI development will lag changes to the pallet implementation."}),"\n",(0,a.jsx)(n.h3,{id:"milestone-1-improve-parachain-staking-pallet",children:"Milestone 1: Improve Parachain-Staking Pallet"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Estimated Duration:"})," 4 weeks"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Costs:"})," 20000 DAI"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["In addition to updating Rust crate-level docs and ",(0,a.jsx)(n.a,{href:"https://meta5.world/stake-docs/",children:"outdated user-level docs"})," in step (5), we will also pursue the following changes to the current ",(0,a.jsx)(n.a,{href:"https://github.com/PureStake/moonbeam/tree/master/pallets/parachain-staking/src",children:(0,a.jsx)(n.code,{children:"parachain-staking"})})," implementation:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Benchmark to derive transaction weights. This work has been started in ",(0,a.jsx)(n.a,{href:"https://github.com/PureStake/moonbeam/pull/372",children:"this PR"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Security Research Labs reported two critical vulnerabilities in ",(0,a.jsx)(n.code,{children:"parachain-staking"}),": (i) total locked balance was not updated in ",(0,a.jsx)(n.code,{children:"{collator, nominator}_bond_more"})," leading to a potential underflow error (which could trigger excessive issuance) (ii) bounded number of nominations per collator allowed any account to fill the slots with the minimum nomination thereby preventing higher nominations."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["The inflation logic implemented in ",(0,a.jsx)(n.a,{href:"https://github.com/PureStake/moonbeam/blob/master/pallets/parachain-staking/src/inflation.rs",children:(0,a.jsx)(n.code,{children:"parachain-staking"})})," is minimal. Instead of integrating ",(0,a.jsx)(n.code,{children:"pallet-staking"}),"'s reward curve, the current implementation calculates per-round inflation derived from an annual inflation rate. Although the inflation rate can be updated by governance (sudo as of now), it is constant. Some parachain teams (i.e. Kilt) have requested configurable inflation that uses ",(0,a.jsx)(n.code,{children:"pallet-staking"}),"'s reward curve instead because it has been audited and reviewed more closely."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Moonbeam reserves 30% of inflation for future parachain bond(s). To support this functionality, ",(0,a.jsx)(n.code,{children:"parachain-staking"})," added the storage item ",(0,a.jsx)(n.code,{children:"ParachainBondConfig"}),". This storage item is updatable by the root origin; it configures the percent (30%) of inflation reserved as well as the ",(0,a.jsx)(n.code,{children:"AccountId"})," which receives the reserved funds. This feature is convenient for parachains in the Polkadot ecosystem, all of which must pay rent to the network by locking funds in the parachain bond."]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Number"}),(0,a.jsx)(n.th,{children:"Deliverable"}),(0,a.jsx)(n.th,{children:"Specification"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"0a."}),(0,a.jsx)(n.td,{children:"License"}),(0,a.jsx)(n.td,{children:"GPL3"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"0d."}),(0,a.jsx)(n.td,{children:"Documentation"}),(0,a.jsxs)(n.td,{children:["Update Rust crate-level docs and ",(0,a.jsx)(n.a,{href:"https://meta5.world/stake-docs/",children:"user-level docs"})," with implementation details."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"1."}),(0,a.jsx)(n.td,{children:"Benchmark"}),(0,a.jsx)(n.td,{children:"Benchmark the existing implementation to derive transaction weights and discern optimization opportunities."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"2."}),(0,a.jsx)(n.td,{children:"Patch SR-Labs Critical Vulnerabilities"}),(0,a.jsx)(n.td,{children:"Patch both critical vulnerabilities reported by SR labs."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"3."}),(0,a.jsx)(n.td,{children:"Configurable Inflation"}),(0,a.jsxs)(n.td,{children:["Replace sudo with governance origin for setting inflation rate. Provide instructions for replacing constant inflation with ",(0,a.jsx)(n.code,{children:"pallet-staking"}),"'s reward curve logic."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"4."}),(0,a.jsx)(n.td,{children:"Configurable Parachain Bond Reservation"}),(0,a.jsx)(n.td,{children:"Add optional parachain bond configuration that enables reserving a portion of inflation for future parachain bonds."})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"milestone-2-parachain-staking-polkadot-js-ui",children:"Milestone 2: Parachain-Staking Polkadot-JS UI"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Estimated Duration:"})," 4 weeks"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Costs:"})," 10000 DAI"]}),"\n"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Number"}),(0,a.jsx)(n.th,{children:"Deliverable"}),(0,a.jsx)(n.th,{children:"Specification"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"0a."}),(0,a.jsx)(n.td,{children:"License"}),(0,a.jsx)(n.td,{children:"Apache 2.0"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"1."}),(0,a.jsx)(n.td,{children:"Custom Polkadot-JS UI"}),(0,a.jsxs)(n.td,{children:["An overlay UI using polkadot-js similar to the ",(0,a.jsx)(n.code,{children:"pallet-staking"})," UI"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"2."}),(0,a.jsx)(n.td,{children:"PR polkadot-js apps"}),(0,a.jsx)(n.td,{children:"Make a pull request to polkadot-js apps with output"})]})]})]}),"\n",(0,a.jsxs)(n.h2,{id:"additional-information-heavy_plus_sign",children:["Additional Information ","\u2795"]}),"\n",(0,a.jsxs)(n.p,{children:["The current implementation has ",(0,a.jsx)(n.a,{href:"https://github.com/PureStake/moonbeam/blob/master/pallets/parachain-staking/src/tests.rs",children:"significant unit test coverage"})," and this will be maintained throughout the changes listed in Milestone 1. There are also runtime integration tests written in Rust as well as TS integration tests. Maintenance is not explicitly included in the milestones because test coverage is already relatively comprehensive and we have an incentive to maintain it throughout the proposed changes."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);